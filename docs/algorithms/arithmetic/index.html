<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<title>Arithmetic Coding - The Hitchhiker's Guide to Compression</title>
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2709176-10"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2709176-10', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Arithmetic Coding | The Hitchhiker’s Guide to Compression</title>
<meta name="generator" content="Jekyll v4.1.1">
<meta property="og:title" content="Arithmetic Coding">
<meta property="og:locale" content="en_US">
<meta name="description" content="A collection of resources and posts to help people understand compression algorithms.">
<meta property="og:description" content="A collection of resources and posts to help people understand compression algorithms.">
<link rel="canonical" href="/algorithms/arithmetic/">
<meta property="og:url" content="/algorithms/arithmetic/">
<meta property="og:site_name" content="The Hitchhiker’s Guide to Compression"> <script type="application/ld+json"> {"url":"/algorithms/arithmetic/","@type":"WebPage","headline":"Arithmetic Coding","description":"A collection of resources and posts to help people understand compression algorithms.","@context":"https://schema.org"}</script><meta name="google-site-verification" content="OQQP97y5Ybn7sSIdFXUoXhCGOyLfY8ESo5W1eSP4vVU">
</head>
<body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"><title>Link</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"><title>Search</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"><title>Menu</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"><title>Expand</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"><title>Document</title>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar">
<div class="site-header"> <a href="/" class="site-title lh-tight"> The Hitchhiker's Guide to Compression </a> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a>
</div>
<nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list">
<li class="nav-list-item"><a href="/" class="nav-list-link">Overview</a></li>
<li class="nav-list-item"><a href="/getting_started/" class="nav-list-link">Getting Started</a></li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/algorithms/overview/" class="nav-list-link">Overview of Algorithms</a><ul class="nav-list ">
<li class="nav-list-item ">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/algorithms/lz/" class="nav-list-link">Lempel-Ziv</a><ul class="nav-list"><li class="nav-list-item "> <a href="/algorithms/lzss/" class="nav-list-link">LZSS</a>
</li></ul>
</li>
<li class="nav-list-item "><a href="/algorithms/dictionary/" class="nav-list-link">Dictionary Coding</a></li>
<li class="nav-list-item ">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/algorithms/huffman/" class="nav-list-link">Huffman</a><ul class="nav-list"><li class="nav-list-item "> <a href="/algorithms/huffam-program/" class="nav-list-link">Tree Building Implementation</a>
</li></ul>
</li>
<li class="nav-list-item "><a href="/algorithms/dmc/" class="nav-list-link">Dynamic Markov Compression</a></li>
<li class="nav-list-item active"><a href="/algorithms/arithmetic/" class="nav-list-link active">Arithmetic Coding</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/interactive/interactive/" class="nav-list-link">Interactive Algorithms</a><ul class="nav-list ">
<li class="nav-list-item ">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/interactive/lz/lz/" class="nav-list-link">LZ77/LZSS</a><ul class="nav-list">
<li class="nav-list-item "> <a href="/interactive/lz/fullscreen_encoder/" class="nav-list-link">Fullscreen Encoder</a>
</li>
<li class="nav-list-item "> <a href="/interactive/lz/fullscreen_decoder/" class="nav-list-link">Fullscreen Decoder</a>
</li>
</ul>
</li>
<li class="nav-list-item "><a href="/interactive/arithmetic/" class="nav-list-link">Arithmetic Encoder</a></li>
</ul>
</li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/reference/reference/" class="nav-list-link">Reference</a><ul class="nav-list ">
<li class="nav-list-item "><a href="/reference/bytes/" class="nav-list-link">Bytes and Binary</a></li>
<li class="nav-list-item "><a href="/reference/encodings/" class="nav-list-link">Character Encodings</a></li>
<li class="nav-list-item "><a href="/reference/compression_ratios/" class="nav-list-link">Compression Ratios</a></li>
<li class="nav-list-item "><a href="/reference/magic_numbers/" class="nav-list-link">Unix Magic Numbers</a></li>
<li class="nav-list-item "><a href="/reference/raisin/" class="nav-list-link">Raisin</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="/resources/" class="nav-list-link">Resources</a></li>
<li class="nav-list-item"><a href="/contributing/" class="nav-list-link">Contributing</a></li>
<li class="nav-list-item"><a href="/attributions/" class="nav-list-link">Attributions</a></li>
</ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer>
</div>
<div class="main" id="top">
<div id="main-header" class="main-header">
<div class="search">
<div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search The Hitchhiker's Guide to Compression" aria-label="Search The Hitchhiker's Guide to Compression" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
</div>
<div id="search-results" class="search-results"></div>
</div>
<nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list">
<li class="aux-nav-list-item"> <a href="//github.com/pmarsceill/just-the-docs" class="site-button"> Just the Docs on GitHub </a>
</li>
<li class="aux-nav-list-item"> <a href="https://github.com/go-compression/go-compression.github.io" class="site-button"> View on GitHub </a>
</li>
</ul></nav>
</div>
<div id="main-content-wrap" class="main-content-wrap">
<nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list">
<li class="breadcrumb-nav-list-item"><a href="/algorithms/overview/">Overview of Algorithms</a></li>
<li class="breadcrumb-nav-list-item"><span>Arithmetic Coding</span></li>
</ol></nav><div id="main-content" class="main-content" role="main">
<h1 id="arithmetic-coding"> <a href="#arithmetic-coding" class="anchor-heading" aria-labelledby="arithmetic-coding"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Arithmetic Coding</h1>
<p>In the world of dictionary coding and probability based encoding, the floating point weirdness that is arithmetic coding is a refreshing and surprisingly efficient lossless compression algorithm. The algorithm takes the form of two stages, the first stage translates a string into a floating point range and the second stage translates this into a binary sequence. Let’s take a look at how each stage works.</p>
<h2 id="stage-1-floating-point-ranges"> <a href="#stage-1-floating-point-ranges" class="anchor-heading" aria-labelledby="stage-1-floating-point-ranges"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stage 1: Floating Point Ranges</h2>
<p>At a very broad level arithmetic coding works by taking a character and assigning it a frequency to a table. This frequency is then mapped to a number line between 0 and 1. So, if we have the character frequency table as shown below for the word “HELLO”, we would end up with our number line shown below.</p>
<div class="table-wrapper"><table>
<thead><tr>
<th>Character</th>
<th>Frequency</th>
<th>Probability</th>
</tr></thead>
<tbody>
<tr>
<td>H</td>
<td>1</td>
<td>20%</td>
</tr>
<tr>
<td>E</td>
<td>1</td>
<td>20%</td>
</tr>
<tr>
<td>L</td>
<td>2</td>
<td>40%</td>
</tr>
<tr>
<td>O</td>
<td>1</td>
<td>20%</td>
</tr>
</tbody>
</table></div>
<p><img src="/assets/arithmetic1.png" alt="Arithmetic number line"></p>
<p>To do the encoding, we need a floating point range representing our encoded string. So, for example, let’s encode “HELLO”. We start out by encoding just the letter “H”, which would give us the range of 0 to 0.2. However, we’re not just encoding “H” so, we need to encode “E”. To encode “E” we take the range from encoding “H”, 0 to 0.2, and apply our same frequency table to that. You can see this represented below.</p>
<p><img src="/assets/arithmetic2.png" alt="Arithmetic number line with two frequency tables"></p>
<p>Blown up, you can see that we’re essentially copying the number line down, but fitting it within the range of 0 to 0.2 instead of 0 to 1.</p>
<p><img src="/assets/arithmetic3.png" alt="Arithmetic number line with the range of 0-0.2"></p>
<p>Now, we’ll encode the letter “E”, and we can see it falls within the range of 0.04 to 0.08.</p>
<p><img src="/assets/arithmetic4.png" alt='Arithmetic number line with the range of 0-0.2 with "HE" encoded'></p>
<p>As we move through this process, this copying of the number line and fitting it within the previous range continues until we encode our entire string. Though, if you’re familiar with floating point arithmetic in computers, you know that <a href="https://stackoverflow.com/questions/21895756/why-are-floating-point-numbers-inaccurate">computers aren’t good with decimals</a>, especially long ones. There are <a href="https://softwareengineering.stackexchange.com/questions/167147/why-dont-computers-store-decimal-numbers-as-a-second-whole-number">some workarounds</a> to this, but generally floating point math is too inefficient or innaccurate to make arithmetic coding work quickly or properly for compression.</p>
<p>The answer to this issue is called finite-precision arithmetic coding, with the above approach of fitting the number line within a range known as the infinite-precision version because we (supposedly) have an infinite amount of precision.</p>
<p>Now if we continue this process, we get a range representing 0.06368 to 0.06496. The difference between these two numbers is just 0.00128, a big difference from the 0.2 difference when encoding just “H”. You can imagine that larger files will have an even smaller difference between the two ranges, spelling out the need for finite-precision arithmetic coding.</p>
<h2 id="stage-2-binary-search"> <a href="#stage-2-binary-search" class="anchor-heading" aria-labelledby="stage-2-binary-search"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Stage 2: Binary Search</h2>
<p>The next, and luckily final, stage is to run a binary search-like algorithm over the table to find a binary range that lays within our range from the first stage.</p>
<p>The way this works is actually quite simple. We take our number line from 0 to 1, and lay it out.</p>
<p><img src="/assets/arithmetic1.png" alt="Arithmetic number line"></p>
<p>Then, we plot our range on the number line, and place our current target in the middle of the range: 0.5.</p>
<p><img src="/assets/arithmetic5.png" alt="Arithmetic number line with target and range"></p>
<p>The trick is to see whether our range falls on the <strong>left</strong> or <strong>right</strong> side of our target (0.5). In this case, our range pretty clearly falls on the left hand side so we output a 0. If it fell on the right hand side we would output a 1.</p>
<p>Now here’s where things get interesting. We change the top end of our range from 1 to 0.5, so now we’re looking at the range from 0 to 0.5, with out target at 0.25 (0.25 is in between 0 and 0.5).</p>
<p><img src="/assets/arithmetic6.png" alt="Arithmetic number line with target and range from 0-0.5"></p>
<p>You can see the range moves closer to our target and the area between gets a little larger. It’s important to note we’re not changing the range, just looking at it magnified. Our range is still below 0.25 so we’ll output a 0 and repeat this process for the range of 0-0.25.</p>
<p>This continues until you’re left with a binary sequence that represents a target, just like the 0.5 and 0.25 from earlier examples, that lays within our encoded range from stage 1. This binary stream is the coded version (the compressed version) as we can use it to get back to the original string with the right frequency table.</p>
<h2 id="infinite-vs-finite-precision"> <a href="#infinite-vs-finite-precision" class="anchor-heading" aria-labelledby="infinite-vs-finite-precision"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Infinite vs. Finite Precision</h2>
<p>Infinite precision is the process that we just went over with two stages. However as we saw, the more characters we encode, the smaller the difference between our range floor and ceiling gets. This means that as we encode more and more characters the top and bottom sections of the range will eventually meet and represent the same value because a typical 32-bit system cannot represent infinite precision. There are ways around this, such as increasing the size of the floating point number’s precision or using infinite precision, but these solutions don’t work for all data or are very inefficient respectively.</p>
<p>The harder solution is to combine these steps in one stage, which is called finite-precision arithmetic coding because it only requires a finite amount of precision to operate. This version works by encoding the first character, then immediately trying to see if the range falls above or below 0.5. If so, it will output the binary number representing which half it lays within and will “blow up” the range so that it doesn’t lose precision. There is also an important corner-case of encoding a “10” or “01” if the range lays within 0.25-0.75 which requires memory to be carried over from each encoding.</p>
<p>To put it simply, infinite-precision arithmetic coding is a simple and easy way to understand arithmetic coding while finite-precision arithmetic coding is more complicated but scalable and efficient.</p>
<p>Now unfortunately I can’t explain how to implement your own version of finite-precision arithmetic coding well enough to be comprehensive, so I’ll redirect you to a <a href="https://marknelson.us/posts/2014/10/19/data-compression-with-arithmetic-coding.html">wonderful article by Mark Nelson</a> that explains how to write an arithmetic coder with infinite and finite precision. There are also some wonderful online lectures by mathematicalmonk on YouTube that go into detail about <a href="https://www.youtube.com/watch?v=-7i6HaYhyW4">finite-precision coding</a> in a visual way. If anything in this article doesn’t make sense to you then I can’t recommend mathematicalmonk’s YouTube lectures and Mark Nelson’s article. <a href="https://www.youtube.com/watch?v=FdMoL3PzmSA">Arithmetic Compression from Compressor Head</a> on YouTube is also a great and enjoyable primer on the topic.</p>
<h2 id="adaptive-arithmetic-coding"> <a href="#adaptive-arithmetic-coding" class="anchor-heading" aria-labelledby="adaptive-arithmetic-coding"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adaptive Arithmetic Coding</h2>
<p>One last variation of arithmetic coding worth mentioning is the idea of adaptive arithmetic coding. This version works in mostly the same way as typical arithmetic coding except that rather than building a frequency table from the source, it builds the frequency table as it encodes each character.</p>
<p>This means if you were encoding “HELLO”, it would start with “H” representing 100% of the table. When it encoded the “E”, it would update the frequency table so “H” would represent 50% of the table and “E” representing the remaining 50%. This concept allows arithmetic coding to adapt to the content as it’s encoding which allows it to achieve a higher <a href="/reference/compression_ratios/">compression ratio</a>.</p>
<h2 id="resources"> <a href="#resources" class="anchor-heading" aria-labelledby="resources"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Resources</h2>
<p>If you’re interested in learning more about arithmetic coding, check out these great resources:</p>
<ul>
<li><a href="https://marknelson.us/posts/2014/10/19/data-compression-with-arithmetic-coding.html">Mark Nelson - Data Compression With Arithmetic Coding</a></li>
<li><a href="https://www.youtube.com/watch?v=FdMoL3PzmSA">Arithmetic Compression from Compressor Head</a></li>
<li><a href="https://www.youtube.com/watch?v=-7i6HaYhyW4">mathematicalmonk - Arithmetic Coding</a></li>
</ul>
<hr>
<footer><p><a href="#top" id="back-to-top">Back to top</a></p>
<p class="text-small text-grey-dk-000 mb-0">If you see something off, please consider <a href="https://go-compression.github.io/contributing/">contributing</a>.</p>
<div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/go-compression/go-compression.github.io/edit/master/site/algorithms/arithmetic.md" id="edit-this-page">Edit this page on GitHub.</a></p></div></footer>
</div>
</div>
<div class="search-overlay"></div>
</div>
</body>
</html>
